<meta name="viewport" content="width=device-width, initial-scale=1" charset="utf-8">
<html lang="en">
	<head>
		<title> VR Patterns </title>
		<script src="https://cdn.babylonjs.com/babylon.js"></script>
		<script src="https://cdn.babylonjs.com/gui/babylon.gui.js"></script>                  <!-- plugin for GUI-->
		<script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>    <!-- plugin for loading 3D models-->
		<script src="https://unpkg.com/earcut@2.1.1/dist/earcut.min.js"></script>     
		<script src = "js/navigations.js"></script>    
		          
        <script src = "js/scripts.js"></script>    
		<style>
			canvas 
			{
				width: 100%; height: 100%; background-color: black;
			}
		</style>
    </head>

        <body>
            <canvas class="sceneCanvas" id = "patternCanvas"></canvas>
            <script type = "text/javascript">
                const canvas = document.getElementById("sceneCanvas");      //get the canvas element
                const engine = new BABYLON.Engine(canvas, true);            //generates the babylon 3D engine
                
                let sceneOpen           = createOpenScene();
                let sceneOffice         = createOfficeScene();
                let sceneConference     = createConferenceScene();

                let clicks              = 0;
                let advancedTexture     = null;                        
                let defaultXRExperience;
                let curScene = sceneOpen;

                let createGUI = function()
                {
                    if (advancedTexture !== null)
                        advancedTexture.dispose(); 
                    advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI", true, curScene);
                    
                    //Button to change scenes
                    let buttonScene = BABYLON.GUI.Button.CreateSimpleButton("but", "Scene #" + (clicks % 3));
                    buttonScene.width = 0.2;
                    buttonScene.height = "40px";
                    buttonScene.color = "white";
                    buttonScene.background = "grey";
                    buttonScene.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP
                    advancedTexture.addControl(buttonScene);
                    buttonScene.onPointerDownObservable.add(
                        function()
                        {
                            clicks++;
                            switch (clicks % 3) {
                                default:
                                case 0:
                                    curScene = sceneOpen;
                                    createGUI();                                            
                                    break;
                                case 1:
                                    curScene = sceneConference;
                                    createGUI();                                            
                                    break;
                                case 2:  
                                    curScene = sceneOffice;
                                    createGUI();                                            
                                    break;
                            }
                        }
                    );
                    
                    //Button to open and close insprector
                    let button = BABYLON.GUI.Button.CreateSimpleButton("butInspect", "Inspector");
                    button.width = 0.2;
                    button.height = "40px";
                    button.color = "white";
                    button.background = "gray";
                    button.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
                    advancedTexture.addControl(button);
                    button.onPointerDownObservable.add(
                        function()
                        {
                            //inspector just for editing, REMOVE LATER
                            if (curScene.debugLayer.isVisible())
                                curScene.debugLayer.hide();
                            else
                                curScene.debugLayer.show();
                        }
                    );
                    //init vr
                    defaultXRExperience = curScene.createDefaultXRExperienceAsync({
                        floorMeshes: [curScene.floorMeshes]
                    });
                    if (!defaultXRExperience.baseExperience) {
                        // no xr support
                    } else {
                        // all good, ready to go
                        //teleportationPatterns(defaultXRExperience, curScene.floorMeshes);
                        hotspotPattern(defaultXRExperience, curScene.floorMeshes, curScene.hotspots);
                    }
                }
                createGUI(sceneOpen);
                //disable scrolling on webpage when curser on canvas
                canvas.addEventListener('wheel', (e) => {e.preventDefault()}, false);
                engine.runRenderLoop(function()
                {
                    curScene.render();
                });

                window.addEventListener("resize", function()
                {
                    engine.resize();                            
                });                        

            </script>
            
	</body>
</html>